---

setup:
  addons:
    - plan: heroku-postgres
      as: DATABASE
      as: HEROKU_POSTGRESQL_RED
      as: HEROKU_POSTGRESQL_BLACK

  config:
    # NODE_ENV: production
    USER_DB: $USER_DB
    ORDER_DB: $ORDER_DB
    PRODUCT_DB: $PRODUCT_DB


  config:
    APP_NAME: debby-hand-knits

build:
  docker:
    web: frontend-service/Dockerfile
    users: backend-user_service/Dockerfile
    products: backend-product_service/Dockerfile
    orders: backend-order_service/Dockerfile

  config:
    # NODE_ENV: production
    USER_DB: $USER_DB
    ORDER_DB: $ORDER_DB
    PRODUCT_DB: $PRODUCT_DBc

run:
    # web: docker-compose -f docker-compose.deploy.yml up -d
    # web: npm start
    add_products:
      command:
        - python app/add_products.py
        - docker exec -i debby-hand-knits_product_1 python app/add_products.py
        image:
          products